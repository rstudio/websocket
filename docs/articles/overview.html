<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overview • websocket</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Overview">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">websocket</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Learning
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/overview.html">Overview</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Overview</h1>
            
            <h4 class="date">2019-03-18</h4>
      
      
      <div class="hidden name"><code>overview.Rmd</code></div>

    </div>

    
    
<p><code>websocket</code> is a <a href="https://en.wikipedia.org/wiki/WebSocket">WebSocket</a> client package for R backed by the <a href="https://github.com/zaphoyd/websocketpp">websocketpp</a> C++ library.</p>
<p>WebSocket clients are most commonly used from <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_client_applications">JavaScript in a web browser</a>, and their use in R with this package is not much different. The experience of using <code>websocket</code> is designed to be similar to the experience of using WebSockets in a browser.</p>
<p>Like WebSockets in a browser, <code>websocket</code> makes it easy to asynchronously process data from a WebSocket server. In the context of an R or Shiny application, this functionality is useful for incrementally consuming data from an external data source presented as a WebSocket server.</p>
<div id="creating-websockets" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-websockets" class="anchor"></a>Creating WebSockets</h2>
<p>WebSockets are represented as instances of an <a href="https://github.com/r-lib/R6">R6</a> object, and are created with <code>$new()</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>ws &lt;-<span class="st"> </span>WebSocket<span class="op">$</span><span class="kw">new</span>(<span class="st">"ws://echo.websocket.org/"</span>)</span></code></pre></div>
<p>By default, and similarly to how WebSockets in JavaScript work, constructing a WebSocket with <code>$new()</code> will automatically initiate the WebSocket connection. In normal usage, such as in a Shiny app or from within a function, this default behavior is ideal. When run interactively from the R console however, the default behavior is problematic. The reason is that the connection will open before the user is given an opportunity to register any event handlers, meaning messages from the server could be dropped.</p>
<p>So, in the console, WebSockets should be created like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>ws &lt;-<span class="st"> </span>WebSocket<span class="op">$</span><span class="kw">new</span>(<span class="st">"ws://echo.websocket.org/"</span>, <span class="dt">autoConnect =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
</div>
<div id="interaction-with-later" class="section level2">
<h2 class="hasAnchor">
<a href="#interaction-with-later" class="anchor"></a>Interaction with <code>later</code>
</h2>
<p>The technical reason that <code>autoConnect = FALSE</code> is necessary at the console has to do with how <a href="https://github.com/r-lib/later">later</a> works. <code>later</code> is a package for scheduling functions to run in the future used by <code>websocket</code> to continuously check for WebSocket events.</p>
<p>Functions scheduled for future execution with <code>later</code> will not be run until <em>after</em> the function in which the scheduling occurred has returned. Internally, <code>$new()</code> schedules a function with <code>later</code> that connects to the WebSocket server.</p>
<p>Because <code>$new()</code> only <em>schedules</em> the work of connecting — it does not perform it immediately — it’s safe within a code block to attach handlers, because none of them can possibly run until after the enclosing block returns.</p>
</div>
<div id="adding-handlers" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-handlers" class="anchor"></a>Adding handlers</h2>
<p>After a <code>WebSocket</code> object is created, you have an opportunity to associate handler functions with various WebSocket events using the following R6 methods:</p>
<ol style="list-style-type: decimal">
<li>
<code>$onOpen()</code>: Invoked when the connection is first opened</li>
<li>
<code>$onMessage()</code>: Invoked when a message is received from the server</li>
<li>
<code>$onClose()</code>: Invoked when the client or server closes the connection</li>
<li>
<code>$onError()</code>: Invoked when an error occurs</li>
</ol>
<p>For example, the following code instantiates a WebSocket, installs an <code>onOpen</code> handler, and prints a message once the WebSocket is open:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>{</span>
<span id="cb3-2"><a href="#cb3-2"></a>  ws &lt;-<span class="st"> </span>WebSocket<span class="op">$</span><span class="kw">new</span>(<span class="st">"ws://echo.websocket.org/"</span>)</span>
<span id="cb3-3"><a href="#cb3-3"></a>  ws<span class="op">$</span><span class="kw">onOpen</span>(<span class="cf">function</span>(event) {</span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"connected</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb3-5"><a href="#cb3-5"></a>  })</span>
<span id="cb3-6"><a href="#cb3-6"></a>}</span></code></pre></div>
<blockquote>
<p>Note that because the <code>$new()</code> and <code>$onOpen()</code> calls are within the same code block, <code>autoConnect</code> does not need to be <code>FALSE</code>.</p>
</blockquote>
<div id="event-environment" class="section level3">
<h3 class="hasAnchor">
<a href="#event-environment" class="anchor"></a>Event environment</h3>
<p>Every handler function is passed an <code>event</code> environment. This environment contains at least the entry <code>target</code>, which is a reference to the WebSocket object on which the event occurred.</p>
<p>In addition to <code>target</code>, other entries are available depending on the handler type:</p>
<ul>
<li>
<code>$onMessage()</code>
<ul>
<li>
<code>data</code>: Text or binary data received from the server, as a character vector or raw vector, respectively</li>
</ul>
</li>
<li>
<code>$onClose()</code>
<ul>
<li>
<code>code</code>: The numeric <a href="https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent">close code</a>
</li>
<li>
<code>reason</code>: Character vector, the reason for closing</li>
</ul>
</li>
<li>
<code>$onError()</code>
<ul>
<li>
<code>message</code>: Character vector, an error message</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="removing-handlers" class="section level2">
<h2 class="hasAnchor">
<a href="#removing-handlers" class="anchor"></a>Removing handlers</h2>
<p>Multiple handler functions for the same event type can be added to the WebSocket by repeatedly calling a handler registration method such as <code>$onMessage()</code>.</p>
<p>The return value of every registration method is a zero-argument function that may be invoked to <strong>deregister</strong> the handler function.</p>
<p>The following is an example of an <code>$onMessage()</code> handler that immediately removes itself:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>{</span>
<span id="cb4-2"><a href="#cb4-2"></a>  ws &lt;-<span class="st"> </span>WebSocket<span class="op">$</span><span class="kw">new</span>(<span class="st">"ws://echo.websocket.org/"</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a>  removeThis &lt;-<span class="st"> </span>ws<span class="op">$</span><span class="kw">onMessage</span>(<span class="cf">function</span>(event) {</span>
<span id="cb4-4"><a href="#cb4-4"></a>    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"this is the last time i'll run</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb4-5"><a href="#cb4-5"></a>    <span class="kw">removeThis</span>()</span>
<span id="cb4-6"><a href="#cb4-6"></a>  })</span>
<span id="cb4-7"><a href="#cb4-7"></a>  ws<span class="op">$</span><span class="kw">onOpen</span>(<span class="cf">function</span>(event) {</span>
<span id="cb4-8"><a href="#cb4-8"></a>    ws<span class="op">$</span><span class="kw">send</span>(<span class="st">"one"</span>)</span>
<span id="cb4-9"><a href="#cb4-9"></a>    ws<span class="op">$</span><span class="kw">send</span>(<span class="st">"two"</span>)</span>
<span id="cb4-10"><a href="#cb4-10"></a>  })</span>
<span id="cb4-11"><a href="#cb4-11"></a>}</span></code></pre></div>
<p>Even though <code>ws$send()</code> is called twice in the <code>$onOpen()</code> handler function, the <code>$onMessage()</code> handler function is only run once.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#creating-websockets">Creating WebSockets</a></li>
      <li><a href="#interaction-with-later">Interaction with <code>later</code></a></li>
      <li><a href="#adding-handlers">Adding handlers</a></li>
      <li><a href="#removing-handlers">Removing handlers</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Alan Dipert, Barbara Borges, Winston Chang, Joe Cheng.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
